 ///////////////////////////////////////
       version="version templategp.lib 0.1 Sept_2022 ";
       category="Algebraic geometry";
       info="
       LIBRARY: templategp.lib  procedure to calculate the blow up of affine space at a point

       OVERVIEW:
           This library contains a SINGULAR procedures to calculate the blow up of an affine
           variety at a point. It uses a ring independant chart data structure that consists of
           a ring and two ideals, both of which are in the ring. The first ideal defines an algebraic
           variety, while the second ideal defines by its complement an open set that meets the
           variety. 
            

       PROCEDURES:
       BlowUpAff(token)               computes the blow up of an affine variety at a point
       
";

LIB "ring.lib";
LIB "elim.lib";

proc BlowUpAff(token T)
"USAGE: BlowUpAff(T); T token
ASSUME: T contains a chart and a center
RETURN: token output containing the blow up of the chart at the given center
EXAMPLE: example BlowUpAff, shows an example"
{
newstruct ("chart", "ring in, ideal vari, ideal D");
chart Q;

Q.vari = T.data[2];
Q.in = T.data[1];
Q.D = T.data[3];
ideal C = T.data[4];
def R = changevar("x()", Q.in);
def S = changevar("y()", Q.in);
list L1 = ringlist(R);
list L2 = ringlist(S);
L1[2] = L1[2]+L2[2];
def T = ring(L1);
chart r;
r.in = R;
setring r.in;
r.vari = 0;
r.D = 1;
chart s;
s.in = S;
setring s.in;
s.vari = 0;
s.D = 1;
chart t;
t.in = T;
setring t.in;
matrix m[2][nvars(R)];
for (int i=1; i<=nvars(R); i=i+1) 
{
  
  m[1,i] = m[1,i] + var(i);
  m[2,i] = m[2,i] + var(i+nvars(R));
}
t.vari = minor(m,2);
ideal J = fetch(Q.in,C); 
for (int i=1; i<=nvars(R); i=i+1) 
{
  t.vari = subst(t.vari, x(i), J[i]); 
}
t.D = 1;
ideal K;
for (int i=1; i<=nvars(S); i=i+1)
{
 K = K + ideal(maxideal(1)[i+nvars(R)]);
}
t.vari = sat(t.vari,K)[1];
token output;
output.fieldnames = list ("chart");
output.data = list(t.in, t.vari, t.D);
return(output);
}
